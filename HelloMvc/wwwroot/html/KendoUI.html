<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>KendoUI</title>

    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2018.1.221/styles/kendo.common.min.css" />
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2018.1.221/styles/kendo.flat.min.css" />
    <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2018.1.221/styles/kendo.flat.mobile.min.css" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.35.4/css/bootstrap-dialog.css">

    <script src="https://kendo.cdn.telerik.com/2018.1.221/js/jquery.min.js"></script>
    <script src="https://kendo.cdn.telerik.com/2018.1.221/js/kendo.all.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.35.4/js/bootstrap-dialog.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-filestyle/2.1.0/bootstrap-filestyle.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" href="layout.css">
    <link rel="stylesheet" href="design.css">

    <style>
    </style>
</head>

<body>
    <div id="example" style="padding: 5px;">
        <div class="row">
            <div class="col-sm-6">
                <div class="panel-group" id="accordion1">
                    <!-- Bootstrap Dialog -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a data-toggle="collapse" data-parent="#accordion1" href="#collapseL1">Bootstrap Dialog</a>
                        </div>
                        <div id="collapseL1" class="panel-collapse collapse in">
                            <div class="panel-body">
                                <button type="button" id="btnLoadTemplate" class="btn btn-sm btn-default">Load Template</button>
                            </div>
                        </div>
                    </div>

                    <!-- Partial View -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a data-toggle="collapse" data-parent="#accordion1" href="#collapseL2">Form Group</a>
                        </div>
                        <div id="collapseL2" class="panel-collapse collapse">
                            <div class="panel-body">
                                <div class="form-horizontal">
                                    <div class="form-group form-group-sm">
                                        <label class="control-label col-sm-2" for="simple-textbox">TextBox:</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="k-textbox full-width" id="simple-textbox">
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label class="control-label col-sm-2" for="simple-datepicker">DatePicker:</label>
                                        <div class="col-sm-10">
                                            <input class="full-width" id="simple-datepicker">
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label class="control-label col-sm-2" for="simple-dropdownlist">DropDownList:</label>
                                        <div class="col-sm-10">
                                            <input class="full-width" id="simple-dropdownlist">
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label class="control-label col-sm-2" for="simple-dropdownlist">MultiSelect:</label>
                                        <div class="col-sm-10">
                                            <select class="full-width" id="simple-multiselect" multiple="multiple"></select>
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <div class="col-sm-offset-2 col-sm-5">
                                            <input type="checkbox" id="simple-checkbox1" class="k-checkbox" checked="checked">
                                            <label class="k-checkbox-label" for="simple-checkbox1">Rear side airbags</label>
                                        </div>
                                        <div class="col-sm-5">
                                            <input type="checkbox" id="simple-checkbox2" class="k-checkbox" checked="checked" disabled="disabled">
                                            <label class="k-checkbox-label" for="simple-checkbox2">Leather trim</label>
                                        </div>
                                    </div>
                                    <div class="form-group form-group-sm">
                                        <label class="control-label col-sm-2" for="simple-textarea">TextArea:</label>
                                        <div class="col-sm-10">
                                            <textarea class="k-textbox full-width" id="simple-textarea" rows="4" style="resize: vertical;"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bootstrap Tooltip -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a data-toggle="collapse" data-parent="#accordion1" href="#collapseL3">Bootstrap Tooltip</a>
                        </div>
                        <div id="collapseL3" class="panel-collapse collapse in">
                            <div class="panel-body">
                                <div id="grid-tooltip"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="panel-group" id="accordion2">
                    <!-- Kendo Grid -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a data-toggle="collapse" data-parent="#accordion2" href="#collapseR1">Kendo Grid</a>
                        </div>
                        <div id="collapseR1" class="panel-collapse collapse">
                            <div class="panel-body">
                                <input type="button" id="create" name="create" value="create" class="k-button">
                                <input type="button" id="update" name="update" value="update" class="k-button">
                                <input type="button" id="destroy" name="destroy" value="destroy" class="k-button">
                                <div id="grid"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Kendo Filter -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a data-toggle="collapse" data-parent="#accordion2" href="#collapseR2">Kendo Grid Filter</a>
                        </div>
                        <div id="collapseR2" class="panel-collapse collapse">
                            <div class="panel-body">
                                <div id="grid-filter"></div>
                            </div>
                        </div>
                    </div>

                    <!-- File Saver -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <a data-toggle="collapse" data-parent="#accordion2" href="#collapseR3">File Saver</a>
                        </div>
                        <div id="collapseR3" class="panel-collapse collapse">
                            <div class="panel-body">
                                <input type="button" id="saveAs" name="saveAs" value="saveAs" class="k-button">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script id="template-form" type="text/template">
        <div class="form-horizontal" style="margin-bottom: -5px;">
            <div class="form-group form-group-sm">
                <label for="inputFirstName" class="col-sm-2 control-label">DropDownList</label>
                <div class="col-sm-10">
                    <input class="full-width" id="dropdownlist2" />
                </div>
            </div>
        </div>
    </script>

    <script>
        // begin BootstrapDialog
        $(function () {
            $("#btnLoadTemplate").click(function () {
                BootstrapDialog.confirm({
                    message: function (dialog) {
                        return $("<div></div>").append($("#template-form").html());
                    },
                    btnCancelClass: "btn-sm btn-default",
                    btnOKClass: "btn-sm btn-primary",
                    onshow: function (dialogRef) {
                        dialogRef.getModalBody().find("#dropdownlist2").kendoDropDownList({
                            dataSource: ["Chai", "Chang", "Tofu"],
                            filter: "contains"
                        });
                        // fix filter issue
                        dialogRef.getModal().removeAttr("tabindex");
                    },
                    callback: function (result) {
                        // result will be true if button was click, while it will be false if users close the dialog directly.
                        if (result) {
                            //alert("Yup.");
                        } else {
                            //alert("Nope.");
                        }
                    }
                });
            });
        });
        // end BootstrapDialog

        // begin form-group
        $(function () {
            $("#simple-datepicker").kendoDatePicker();
            $("#simple-dropdownlist").kendoDropDownList({
                dataSource: {
                    data: ["One", "Two"]
                }
            });
            $("#simple-multiselect").kendoMultiSelect({
                dataSource: {
                    data: ["One", "Two"]
                }
            });

        });
        // end form-group

        // begin Bootstrap Tooltip
        $(function () {
            $("#grid-tooltip").kendoGrid({
                dataSource: [{
                    value: 1,
                    text: "One"
                }, {
                    value: 2,
                    text: "Two"
                }, {
                    value: 3,
                    text: "Three"
                }],
                dataBound: function (e) {
                    $("#grid-tooltip [data-toggle='tooltip']").tooltip();
                },
                columns: [{
                    field: "value",
                    title: "value"
                }, {
                    field: "text",
                    title: "text",
                    template: "<span data-toggle='tooltip' data-placement='right' data-container='\\#grid-tooltip' title='value: #: value #'>#: text #</span>"
                }]
            });
        });
        // end Bootstrap Tooltip

        // begin kendoGrid
        var simpleDataSource = [];
        for (var i = 1; i <= 20; i++) {
            simpleDataSource.push({
                value: guid(),
                text: "text" + i
            });
        }
        $(function () {
            var dataSource = new kendo.data.DataSource({
                transport: {
                    read: function (options) {
                        options.success(simpleDataSource);
                        // notify the data source that the request failed
                        //options.error(result);
                    },
                    update: function (options) {
                        if (options.data.text.length >= 5) {
                            // notify the data source that the request succeeded
                            options.success(options.data);
                        } else {
                            // notify the data source that the request failed
                            alert("error: length < 5");
                            options.error(options.data);
                        }
                    },
                    destroy: function (options) {
                        // notify the data source that the request succeeded
                        options.success(options.data);
                        // notify the data source that the request failed
                        //options.error(result);
                    },
                    create: function (options) {
                        // notify the data source that the request succeeded
                        options.data.value = guid();
                        options.success(options.data);
                        // notify the data source that the request failed
                        //options.error(result);
                    }
                },
                pageSize: 10,
                schema: {
                    model: {
                        id: "value",
                        fields: {
                            value: {
                                editable: false,
                                nullable: true
                            },
                            text: {
                                validation: {
                                    required: true
                                }
                            }
                        }
                    }
                }
            });

            $("#grid").kendoGrid({
                dataSource: dataSource,
                pageable: true,
                //height: 550,
                toolbar: ["create"],
                columns: [{
                    field: "value",
                    title: "value",
                    width: "280px"
                }, {
                    field: "text",
                    title: "text",
                    width: "150px"
                }, {
                    command: ["edit", "destroy"],
                    title: "&nbsp;",
                    width: "180px"
                }],
                editable: "inline",
                selectable: true,
                filterable: true,
                sortable: true,
                noRecords: {
                    template: "No data available on current page. Current page is: #=this.dataSource.page()#"
                }
            });

            $("#create").click(function () {
                var grid = $("#grid").data("kendoGrid");
                var dataItem = {
                    value: guid(),
                    text: "text new"
                };
                grid.dataSource.pushInsert(dataItem);
                var view = grid.dataSource.view();
                if ($.grep(view, function (item, index) {
                        return item.value === dataItem.value;
                    }).length === 0) {
                    grid.dataSource.filter([]);
                    grid.dataSource.sort({});
                }
            });

            $("#update").click(function () {
                var grid = $("#grid").data("kendoGrid");
                var dataItem = grid.dataItem(grid.select());
                if (dataItem) {
                    dataItem.text = dataItem.text + " update";
                    grid.dataSource.pushUpdate(dataItem);
                }
                /*
                var dataItems = grid.dataItems();
                for (var i = dataItems.length - 1; i >= 0; i--) {
                    dataItems[i].ProductName = dataItems[i].ProductName + " *";
                }
                grid.dataSource.pushUpdate(dataItems);
                */
            });

            $("#destroy").click(function () {
                var grid = $("#grid").data("kendoGrid");
                var dataItem = grid.dataItem(grid.select());
                if (dataItem)
                    grid.dataSource.pushDestroy(dataItem);
            });
        });

        // guid
        function guid() {
            function s4() {
                return Math.floor((1 + Math.random()) * 0x10000)
                    .toString(16)
                    .substring(1);
            }
            return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
        }
        // end kendoGrid

        // begin Kendo Grid Filter
        $(function () {
            var dataSource = new kendo.data.DataSource({
                data: [{
                    id: 1,
                    text: "text1",
                    date: new Date(),
                    checked: true
                }, {
                    id: 2,
                    text: "text2",
                    date: new Date(),
                    checked: true
                }, {
                    id: 3,
                    text: "text2",
                    date: new Date(),
                    checked: false
                }, {
                    id: 4,
                    text: "text3",
                    date: new Date(),
                    checked: true
                }, {
                    id: 5,
                    text: "text3",
                    date: new Date(),
                    checked: false
                }],
                pageSize: 10,
                schema: {
                    model: {
                        id: "id",
                        fields: {
                            id: {
                                type: "number"
                            },
                            text: {
                                type: "string"
                            },
                            date: {
                                type: "date"
                            },
                            checked: {
                                type: "boolean"
                            }
                        }
                    }
                }
            });

            $("#grid-filter").kendoGrid({
                dataSource: dataSource,
                pageable: true,
                columns: [{
                    field: "id",
                    title: "id",
                    width: "100px"
                }, {
                    field: "text",
                    title: "text",
                    width: "100px",
                    filterable: {
                        multi: true
                    }
                }, {
                    field: "date",
                    title: "date",
                    width: "200px",
                    format: "{0:yyyy-MM-dd HH:mm:ss}"
                }, {
                    field: "checked",
                    title: "checked",
                    width: "100px"
                }],
                filterable: true,
                sortable: true,
                noRecords: {
                    template: "No data available on current page. Current page is: #=this.dataSource.page()#"
                }
            });
        });
        // end Kendo Grid Filter

        // begin FileSaver
        $(function () {
            $("#saveAs").click(function () {
                var workbook = new kendo.ooxml.Workbook({
                    sheets: [{
                        columns: [{
                            autoWidth: true
                        }, {
                            autoWidth: true
                        }],
                        title: "Customers",
                        rows: [{
                            cells: [{
                                value: "Company Name"
                            }, {
                                value: "Contact"
                            }]
                        }, {
                            cells: [{
                                value: "Around the Horn"
                            }, {
                                value: "Thomas Hardy"
                            }]
                        }, {
                            cells: [{
                                value: "B's Beverages"
                            }, {
                                value: "Victoria Ashworth"
                            }]
                        }]
                    }, {
                        title: "Employees",
                        columns: [{
                            autoWidth: true
                        }, {
                            autoWidth: true
                        }],
                        rows: [{
                            cells: [{
                                value: "First Name"
                            }, {
                                value: "Last Name"
                            }]
                        }, {
                            cells: [{
                                value: "Andrew"
                            }, {
                                value: "Fuller"
                            }]
                        }, {
                            cells: [{
                                value: "Nancy"
                            }, {
                                value: "Davolio"
                            }]
                        }]
                    }]
                });
                /*
                // chrome limit
                workbook.toDataURLAsync().then(function (dataURL) {
                    kendo.saveAs({
                        dataURI: dataURL,
                        fileName: "Test.xlsx"
                    });
                });
                */
                workbook.toDataURLAsync().then(function (dataURL) {
                    var blob = dataURItoBlob(dataURL);
                    saveAs(blob, "Test.xlsx");
                });
            });
        });

        function dataURItoBlob(dataURI) {
            // convert base64/URLEncoded data component to raw binary data held in a string
            var byteString;
            if (dataURI.split(",")[0].indexOf("base64") >= 0)
                byteString = atob(dataURI.split(",")[1]);
            else
                byteString = unescape(dataURI.split(",")[1]);
            // separate out the mime component
            var mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
            // write the bytes of the string to a typed array
            var ia = new Uint8Array(byteString.length);
            for (var i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            return new Blob([ia], {
                type: mimeString
            });
        }
        // end FileSaver
    </script>
</body>

</html>

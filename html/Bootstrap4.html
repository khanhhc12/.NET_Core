<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Bootstrap 4</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="lib/bootstrap4-dialog/dist/css/bootstrap-dialog.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="lib/bootstrap4-dialog/dist/js/bootstrap-dialog.js"></script>
    <script src="lib/zxing/dist/zxing.min.js"></script>
    <script src="lib/jquery-serialize-object/dist/jquery.serialize-object.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
    <div lass="container-fluid" style="padding: 20px;">
        <div class="row">
            <div class="col-sm">
                <div id="accordion1">
                    <div class="card">
                        <div class="card-header" id="headingOne">
                            <h5 class="mb-0">
                                <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne"
                                    aria-expanded="true" aria-controls="collapseOne">
                                    Collapsible Group Item #1
                                </button>
                            </h5>
                        </div>

                        <div id="collapseOne" class="collapse show" aria-labelledby="headingOne"
                            data-parent="#accordion1">
                            <div class="card-body">
                                <button type="button" id="btnShowDialog" class="btn btn-outline-primary btn-sm">
                                    Show Dialog
                                </button>
                                <button type="button" id="btnShowConfirm" class="btn btn-outline-primary btn-sm">
                                    Show Confirm
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" id="headingTwo">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseTwo"
                                    aria-expanded="false" aria-controls="collapseTwo">
                                    Collapsible Group Item #2
                                </button>
                            </h5>
                        </div>
                        <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion1">
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#menu1"
                                            role="tab" aria-controls="menu1" aria-selected="true">Menu 1</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="profile-tab" data-toggle="tab" href="#menu2" role="tab"
                                            aria-controls="menu2" aria-selected="false">Menu 2</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="contact-tab" data-toggle="tab" href="#menu3" role="tab"
                                            aria-controls="menu3" aria-selected="false">Menu 3</a>
                                    </li>
                                </ul>
                                <div class="tab-content" id="myTabContent">
                                    <div class="tab-pane fade show active" id="menu1" role="tabpanel"
                                        aria-labelledby="menu1-tab">
                                        ...</div>
                                    <div class="tab-pane fade" id="menu2" role="tabpanel" aria-labelledby="menu2-tab">
                                        ...
                                    </div>
                                    <div class="tab-pane fade" id="menu3" role="tabpanel" aria-labelledby="menu3-tab">
                                        ...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header" id="headingThree">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed" data-toggle="collapse"
                                    data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    Collapsible Group Item #3
                                </button>
                            </h5>
                        </div>
                        <div id="collapseThree" class="collapse" aria-labelledby="headingThree"
                            data-parent="#accordion1">
                            <div class="card-body">
                                <form id="formObject">
                                    <div class="form-row">
                                        <div class="form-group col-md-6">
                                            <label for="input_objA_propA">objA.propA</label>
                                            <input type="text" class="form-control" id="input_objA_propA"
                                                name="objA[propA]">
                                        </div>
                                        <div class="form-group col-md-6">
                                            <label for="input_objA_propB">objA.propB</label>
                                            <input type="text" class="form-control" id="input_objA_propB"
                                                name="objA[propB]">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="input_objB_propA">objB.propA</label>
                                        <select id="input_objB_propA" class="form-control" name="objB[propA]">
                                            <option hidden>Choose...</option>
                                            <option>...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="input_objB_propB"
                                                name="objB[propB]">
                                            <label class="form-check-label" for="input_objB_propB">
                                                objB.propB
                                            </label>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-primary btn-sm"
                                        onclick="formLoad()">Load</button>
                                    <button type="button" class="btn btn-primary btn-sm"
                                        onclick="formGet()">Get</button>
                                    <button type="button" class="btn btn-primary btn-sm"
                                        onclick="formClear()">Clear</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm">
                <div id="accordion2">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <button class="btn btn-link" data-toggle="collapse" data-target="#collapse-right1"
                                    aria-expanded="true" aria-controls="collapse-right1">
                                    Collapsible Group Item #1
                                </button>
                            </h5>
                        </div>
                        <div id="collapse-right1" class="collapse show" data-parent="#accordion2">
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="txtScan2">Scan</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="txtScan2">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" type="button" id="btnScan">Scan</button>
                                        </div>
                                    </div>
                                </div>
                                <div style="display: none">
                                    <div id="scanner">
                                        <div class="form-group">
                                            <label for="txtScan">Scan</label>
                                            <div class="input-group">
                                                <input type="text" class="form-control" id="txtScan" readonly>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="selCamera">Camera</label>
                                            <select class="form-control" id="selCamera">
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <video id="preview" style="border: 1px solid gray; width: 100%"></video>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script>
        // begin BootstrapDialog
        $(function () {
            $("#btnShowDialog").click(function () {
                BootstrapDialog.show({ message: 'Hello World!' });
            });

            $("#btnShowConfirm").click(function () {
                BootstrapDialog.confirm('Hi Apple, are you sure?');
            });
        });
        // end BootstrapDialog

        // begin formObject
        function formLoad() {
            let obj = {
                objA: {
                    propA: "abc",
                    propB: "xyz"
                },
                objB: {
                    propA: "...",
                    propB: true
                }
            };
            let $form = $("#formObject");
            jQuery.each(obj, function (name, item) {
                jQuery.each(item, function (key, value) {
                    let $input = $form.find(`[name='${name}[${key}]']`);
                    if ($input.prop("type") === "checkbox")
                        $input.prop("checked", value ? true : false);
                    else
                        $input.val(value);
                });
            });
        }

        function formGet() {
            let obj = $("#formObject").serializeObject();
            //console.log(obj);
            BootstrapDialog.show({ message: JSON.stringify(obj) });
        }

        function formClear() {
            $("#formObject [type='text']").val("");
            $("#formObject [type='checkbox']").prop("checked", false);
            $("#formObject select").each(function () {
                $(this).val($(this).find("option:first").val());
            });
        }
        // end

        // begin ZXing
        let selectedDeviceId, dialogScanner;
        const codeReader = new ZXing.BrowserQRCodeReader();
        //const codeReader = new ZXing.BrowserBarcodeReader();
        $(function () {
            function decodeContinuously(codeReader, selectedDeviceId) {
                codeReader.decodeFromInputVideoDeviceContinuously(selectedDeviceId, "preview", (result, err) => {
                    if (result) {
                        // properly decoded qr code
                        console.log('Found QR code!', result)
                        $("#txtScan").val(result.text);
                    }
                    if (err) {
                        // As long as this error belongs into one of the following categories
                        // the code reader is going to continue as excepted. Any other error
                        // will stop the decoding loop.
                        //
                        // Excepted Exceptions:
                        //
                        //  - NotFoundException
                        //  - ChecksumException
                        //  - FormatException
                        if (err instanceof ZXing.NotFoundException) {
                            console.log('No QR code found.')
                        }
                        if (err instanceof ZXing.ChecksumException) {
                            console.log('A code was found, but it\'s read value was not valid.')
                        }
                        if (err instanceof ZXing.FormatException) {
                            console.log('A code was found, but it was in a invalid format.')
                        }
                    }
                })
            }

            dialogScanner = new BootstrapDialog({
                message: $("#scanner"),
                autodestroy: false,
                onshown: function (dialogRef) {
                    $("#txtScan").val("");
                    if (!selectedDeviceId) {
                        codeReader.getVideoInputDevices()
                            .then((videoInputDevices) => {
                                const sourceSelect = $("#selCamera");
                                selectedDeviceId = videoInputDevices[0].deviceId;
                                if (videoInputDevices.length >= 1) {
                                    videoInputDevices.forEach((element) => {
                                        sourceSelect.append($("<option>", { value: element.deviceId, text: element.label }));
                                    });
                                    sourceSelect.change(() => {
                                        selectedDeviceId = sourceSelect.val();
                                        codeReader.reset();
                                        decodeContinuously(codeReader, selectedDeviceId);
                                    });
                                    decodeContinuously(codeReader, selectedDeviceId);
                                }
                            })
                            .catch((err) => {
                                console.error(err);
                            });
                    }
                },
                buttons: [{
                    label: "Close",
                    action: function (dialogRef) {
                        dialogRef.close();
                    }
                }, {
                    label: "OK",
                    action: function (dialogRef) {
                        $("#txtScan2").val($.trim($("#txtScan").val()));
                        dialogRef.close();
                    }
                }]
            });
            dialogScanner.realize();

            $("#btnScan").click(function () {
                $("#txtScan2").val("");
                dialogScanner.open();
            });
        });
        // end ZXing
    </script>
</body>

</html>